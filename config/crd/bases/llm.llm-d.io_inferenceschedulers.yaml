---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.18.0
  name: inferenceschedulers.llm.llm-d.io
spec:
  group: llm.llm-d.io
  names:
    kind: InferenceScheduler
    listKind: InferenceSchedulerList
    plural: inferenceschedulers
    shortNames:
    - infsch
    singular: inferencescheduler
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .spec.modelServer.modelName
      name: Model
      type: string
    - jsonPath: .spec.modelServer.replicas
      name: Replicas
      type: integer
    - jsonPath: .status.phase
      name: Phase
      type: string
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: InferenceScheduler is the Schema for the inferenceschedulers
          API
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: InferenceSchedulerSpec defines the desired state of InferenceScheduler
            properties:
              endpointPicker:
                description: EndpointPicker configuration for intelligent routing
                properties:
                  grpcPort:
                    default: 9002
                    description: GRPCPort is the gRPC port for EPP
                    format: int32
                    type: integer
                  image:
                    default: ghcr.io/llm-d/llm-d-inference-scheduler:v0.3.2
                    description: Image is the EPP container image
                    type: string
                  plugins:
                    description: Plugins configuration for routing decisions
                    properties:
                      kvCacheUtilizationScorer:
                        description: KVCacheUtilizationScorer configuration
                        properties:
                          enabled:
                            default: true
                            description: Enabled indicates if this plugin is enabled
                            type: boolean
                          parameters:
                            additionalProperties:
                              type: string
                            description: Parameters are plugin-specific parameters
                            type: object
                          weight:
                            default: 1
                            description: Weight is the weight for this scorer
                            type: number
                        type: object
                      loadAwareScorer:
                        description: LoadAwareScorer configuration
                        properties:
                          enabled:
                            default: true
                            description: Enabled indicates if this plugin is enabled
                            type: boolean
                          parameters:
                            additionalProperties:
                              type: string
                            description: Parameters are plugin-specific parameters
                            type: object
                          weight:
                            default: 1
                            description: Weight is the weight for this scorer
                            type: number
                        type: object
                      prefixCacheScorer:
                        description: PrefixCacheScorer configuration
                        properties:
                          enabled:
                            default: true
                            description: Enabled indicates if this plugin is enabled
                            type: boolean
                          parameters:
                            additionalProperties:
                              type: string
                            description: Parameters are plugin-specific parameters
                            type: object
                          weight:
                            default: 1
                            description: Weight is the weight for this scorer
                            type: number
                        type: object
                    type: object
                  replicas:
                    default: 1
                    description: Replicas is the number of EPP instances
                    format: int32
                    type: integer
                  resources:
                    description: Resources defines resource requirements for EPP pods
                    properties:
                      claims:
                        description: |-
                          Claims lists the names of resources, defined in spec.resourceClaims,
                          that are used by this container.

                          This is an alpha field and requires enabling the
                          DynamicResourceAllocation feature gate.

                          This field is immutable. It can only be set for containers.
                        items:
                          description: ResourceClaim references one entry in PodSpec.ResourceClaims.
                          properties:
                            name:
                              description: |-
                                Name must match the name of one entry in pod.spec.resourceClaims of
                                the Pod where this field is used. It makes that resource available
                                inside a container.
                              type: string
                            request:
                              description: |-
                                Request is the name chosen for a request in the referenced claim.
                                If empty, everything from the claim is made available, otherwise
                                only the result of this request.
                              type: string
                          required:
                          - name
                          type: object
                        type: array
                        x-kubernetes-list-map-keys:
                        - name
                        x-kubernetes-list-type: map
                      limits:
                        additionalProperties:
                          anyOf:
                          - type: integer
                          - type: string
                          pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                          x-kubernetes-int-or-string: true
                        description: |-
                          Limits describes the maximum amount of compute resources allowed.
                          More info: https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/
                        type: object
                      requests:
                        additionalProperties:
                          anyOf:
                          - type: integer
                          - type: string
                          pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                          x-kubernetes-int-or-string: true
                        description: |-
                          Requests describes the minimum amount of compute resources required.
                          If Requests is omitted for a container, it defaults to Limits if that is explicitly specified,
                          otherwise to an implementation-defined value. Requests cannot exceed Limits.
                          More info: https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/
                        type: object
                    type: object
                type: object
              gateway:
                description: Gateway configuration
                properties:
                  className:
                    default: kgateway
                    description: |-
                      ClassName is the GatewayClass to use (e.g., "kgateway", "istio", "gke-l7-regional-external-managed")
                      The GatewayClass must be pre-installed in the cluster
                    enum:
                    - kgateway
                    - istio
                    - gke-l7-regional-external-managed
                    type: string
                  listenerPort:
                    default: 80
                    description: ListenerPort is the HTTP listener port
                    format: int32
                    type: integer
                  name:
                    description: |-
                      Name is the name of the Gateway resource to create
                      If not specified, defaults to <InferenceScheduler-name>-gateway
                    type: string
                  serviceType:
                    default: ClusterIP
                    description: ServiceType is the Kubernetes Service type (ClusterIP,
                      LoadBalancer, NodePort)
                    enum:
                    - ClusterIP
                    - LoadBalancer
                    - NodePort
                    type: string
                type: object
              modelServer:
                description: ModelServer configuration for the inference model (vLLM,
                  TGI, etc.)
                properties:
                  enablePrefixCaching:
                    default: true
                    description: EnablePrefixCaching enables prefix caching in vLLM
                    type: boolean
                  gpuMemoryUtilization:
                    default: 0.9
                    description: GPUMemoryUtilization sets the GPU memory utilization
                      (0.0-1.0)
                    maximum: 1
                    minimum: 0
                    type: number
                  hfTokenSecretName:
                    description: HFTokenSecretName is the name of the secret containing
                      HuggingFace token
                    type: string
                  image:
                    default: vllm/vllm-openai:latest
                    description: Image is the container image for the model server
                    type: string
                  labels:
                    additionalProperties:
                      type: string
                    description: Labels to apply to model server pods
                    type: object
                  modelName:
                    description: ModelName is the HuggingFace model name to deploy
                    type: string
                  port:
                    default: 8000
                    description: Port is the HTTP port for the model server
                    format: int32
                    type: integer
                  replicas:
                    default: 2
                    description: Replicas is the number of model server instances
                    format: int32
                    minimum: 1
                    type: integer
                  resources:
                    description: Resources defines resource requirements for model
                      server pods
                    properties:
                      claims:
                        description: |-
                          Claims lists the names of resources, defined in spec.resourceClaims,
                          that are used by this container.

                          This is an alpha field and requires enabling the
                          DynamicResourceAllocation feature gate.

                          This field is immutable. It can only be set for containers.
                        items:
                          description: ResourceClaim references one entry in PodSpec.ResourceClaims.
                          properties:
                            name:
                              description: |-
                                Name must match the name of one entry in pod.spec.resourceClaims of
                                the Pod where this field is used. It makes that resource available
                                inside a container.
                              type: string
                            request:
                              description: |-
                                Request is the name chosen for a request in the referenced claim.
                                If empty, everything from the claim is made available, otherwise
                                only the result of this request.
                              type: string
                          required:
                          - name
                          type: object
                        type: array
                        x-kubernetes-list-map-keys:
                        - name
                        x-kubernetes-list-type: map
                      limits:
                        additionalProperties:
                          anyOf:
                          - type: integer
                          - type: string
                          pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                          x-kubernetes-int-or-string: true
                        description: |-
                          Limits describes the maximum amount of compute resources allowed.
                          More info: https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/
                        type: object
                      requests:
                        additionalProperties:
                          anyOf:
                          - type: integer
                          - type: string
                          pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                          x-kubernetes-int-or-string: true
                        description: |-
                          Requests describes the minimum amount of compute resources required.
                          If Requests is omitted for a container, it defaults to Limits if that is explicitly specified,
                          otherwise to an implementation-defined value. Requests cannot exceed Limits.
                          More info: https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/
                        type: object
                    type: object
                  type:
                    default: vllm
                    description: Type of model server (vllm, tgi, etc.)
                    enum:
                    - vllm
                    - tgi
                    type: string
                required:
                - hfTokenSecretName
                - modelName
                type: object
            required:
            - modelServer
            type: object
          status:
            description: InferenceSchedulerStatus defines the observed state of InferenceScheduler
            properties:
              conditions:
                description: Conditions represent the latest available observations
                  of the InferenceScheduler's state
                items:
                  description: Condition contains details for one aspect of the current
                    state of this API Resource.
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
              eppReplicas:
                description: EPPReplicas is the current number of EPP replicas
                format: int32
                type: integer
              gatewayReady:
                description: GatewayReady indicates if the Gateway is ready
                type: boolean
              inferencePoolReady:
                description: InferencePoolReady indicates if the InferencePool is
                  ready
                type: boolean
              modelServerReplicas:
                description: ModelServerReplicas is the current number of model server
                  replicas
                format: int32
                type: integer
              phase:
                description: Phase indicates the current phase of the deployment
                type: string
              prerequisiteMessage:
                description: PrerequisiteMessage provides details about missing prerequisites
                type: string
              prerequisitesValidated:
                description: PrerequisitesValidated indicates if all prerequisites
                  (Gateway API, GIE, GatewayClass) are present
                type: boolean
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
